<div class="dashboard-container">
    <div class="max-w-7xl mx-auto space-y-8">

        <!-- Header -->
        <div class="header-section">
            <div class="header-content">
                <h1 class="main-title">Health Analytics</h1>
                <p class="subtitle">Advanced insights from your Apple Health
                    data</p>
            </div>

            <!-- Controls -->
            <div class="controls-section">
                <div class="date-selector">
                    <svg class="icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor">
                        <rect x="3" y="4" width="18" height="18" rx="2"
                            ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <select [(ngModel)]="dateRange"
                        (change)="onDateRangeChange()" class="select-input">
                        <option value="7d">Last 7 days</option>
                        <option value="14d">Last 14 days</option>
                        <option value="30d">Last 30 days</option>
                    </select>
                </div>

                <div class="view-toggle">
                    <button *ngFor="let view of views"
                        [class]="getViewButtonClass(view)"
                        (click)="setSelectedView(view)">
                        {{ view | titlecase }}
                    </button>
                </div>

                <div class="logout-section">
                    <button class="logout-btn" (click)="logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- Daily Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card steps-card"
                (mouseenter)="onCardHover('steps')"
                (mouseleave)="onCardLeave('steps')">
                <div class="card-header">
                    <div class="icon-section">
                        <div class="icon-container steps-icon">
                            <svg class="icon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor">
                                <polyline
                                    points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                            </svg>
                        </div>
                        <h3 class="card-title">Steps</h3>
                    </div>
                    <div class="trend-badge steps-trend">
                        {{ getTrendIndicator('steps') }}{{
                        getTrendPercentage('steps') }}%
                    </div>
                </div>

                <div class="card-content">
                    <div class="main-value">
                        <span class="value-number">{{ stepsStats.current |
                            number }}</span>
                    </div>

                    <div class="stats-details">
                        <div class="stat-row">
                            <span class="stat-label">Avg:</span>
                            <span class="stat-value">{{ stepsStats.average |
                                number:'1.0-0' }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max:</span>
                            <span class="stat-value">{{ stepsStats.max |
                                number:'1.0-0' }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Med:</span>
                            <span class="stat-value">{{ stepsStats.median |
                                number:'1.0-0' }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Min:</span>
                            <span class="stat-value">{{ stepsStats.min |
                                number:'1.0-0' }}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total:</span>
                            <span class="stat-value">{{ stepsStats.total |
                                number:'1.0-0' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stat-card calories-card">
                <div class="card-header">
                    <div class="icon-section">
                        <div class="icon-container calories-icon">
                            <svg class="icon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor">
                                <polygon
                                    points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                            </svg>
                        </div>
                        <h3 class="card-title">Calories</h3>
                    </div>
                    <div class="trend-badge calories-trend">
                        {{ getTrendIndicator('calories') }}{{
                        getTrendPercentage('calories') }}%
                    </div>
                </div>

                <div class="card-content">
                    <div class="main-value">
                        <span class="value-number">{{ caloriesStats.current |
                            number:'1.0-0' }}</span>
                        <span class="unit">{{' kcal'}}</span>
                    </div>

                    <div class="stats-details">
                        <div class="stat-row">
                            <span class="stat-label">Avg:</span>
                            <span class="stat-value">{{ caloriesStats.average |
                                number:'1.0-0' }}{{' kcal'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max:</span>
                            <span class="stat-value">{{ caloriesStats.max |
                                number:'1.0-0' }}{{' kcal'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Med:</span>
                            <span class="stat-value">{{ caloriesStats.median |
                                number:'1.0-0' }}{{' kcal'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Min:</span>
                            <span class="stat-value">{{ caloriesStats.min |
                                number:'1.0-0' }}{{' kcal'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total:</span>
                            <span class="stat-value">{{ caloriesStats.total |
                                number:'1.0-0' }}{{' kcal'}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stat-card distance-card">
                <div class="card-header">
                    <div class="icon-section">
                        <div class="icon-container distance-icon">
                            <svg class="icon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor">
                                <circle cx="12" cy="10" r="3"></circle>
                                <path
                                    d="m12 21.7-.4-.8a13.5 13.5 0 0 1-2.9-8.9c0-7.4 6-13.4 13.4-13.4S35.5 4.6 35.5 12c0 3.4-1.3 6.6-2.9 8.9l-.4.8Z">
                                </path>
                            </svg>
                        </div>
                        <h3 class="card-title">Distance</h3>
                    </div>
                    <div class="trend-badge distance-trend">
                        {{ getTrendIndicator('distance') }}{{
                        getTrendPercentage('distance') }}%
                    </div>
                </div>

                <div class="card-content">
                    <div class="main-value">
                        <span class="value-number">{{ distanceStats.current |
                            number:'1.1-1' }}</span>
                        <span class="unit">{{' km'}}</span>
                    </div>

                    <div class="stats-details">
                        <div class="stat-row">
                            <span class="stat-label">Avg:</span>
                            <span class="stat-value">{{ distanceStats.average
                                }}{{' km'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Max:</span>
                            <span class="stat-value">{{ distanceStats.max
                                }}{{' km'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Med:</span>
                            <span class="stat-value">{{ distanceStats.median
                                }}{{' km'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Min:</span>
                            <span class="stat-value">{{ distanceStats.min
                                }}{{' km'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Total:</span>
                            <span class="stat-value">{{ distanceStats.total
                                }}{{' km'}}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stat-card weight-card">
                <div class="card-header">
                    <div class="icon-section">
                        <div class="icon-container weight-icon">
                            <svg class="icon" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor">
                                <polyline
                                    points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                            </svg>
                        </div>
                        <h3 class="card-title">Weight</h3>
                    </div>
                    <div class="trend-badge weight-trend">
                        -{{ getWeightLossPct() }}%
                    </div>
                </div>

                <div class="card-content">
                    <div class="main-value">
                        <span class="value-number">{{ weightStats.current |
                            number:'1.1-1' }}</span>
                        <span class="unit">{{' kg'}}</span>
                    </div>

                    <div class="stats-details">
                        <div class="stat-row">
                            <span class="stat-label">Initial:</span>
                            <span class="stat-value">{{ getInitialWeight() }}{{' kg'}}</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Loss:</span>
                            <span class="stat-value">{{ getWeightLossKg() }}{{' kg' }} </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <!-- Steps Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                        </svg>
                        {{ getChartTitle('steps') }}
                    </h3>
                    <div class="chart-info">
                        <ng-container [ngSwitch]="selectedView">
                            <span *ngSwitchCase="'weekly'">Total: {{ stepsStats.total | number:'1.0-0' }}</span>
                            <span *ngSwitchCase="'trends'">Avg: {{ stepsStats.average | number:'1.0-0' }}</span>
                            <span *ngSwitchDefault>Total: {{ stepsStats.total | number:'1.0-0' }}</span>
                        </ng-container>
                    </div>
                </div>
                <div class="simple-chart">
                    <!-- Chart type toggle for Steps -->
                    <div class="view-toggle chart-type-toggle">
                        <button class="view-btn" [class.active]="stepsChartType === 'column'" (click)="setStepsChartType('column')">Column</button>
                        <button class="view-btn" [class.active]="stepsChartType === 'line'" (click)="setStepsChartType('line')">Line</button>
                        <button class="view-btn" [class.active]="stepsChartType === 'area'" (click)="setStepsChartType('area')">Area</button>
                    </div>

                    <ng-container [ngSwitch]="stepsChartType">
                        <!-- Column chart -->
                        <div *ngSwitchCase="'column'" class="chart-bars" (mouseleave)="hideBarTooltip('steps')">
                            <div *ngFor="let pt of getStepsChartData(); let i = index; trackBy: trackByIdx"
                                 class="chart-bar steps-bar"
                                 [style.height.%]="(pt.value / getMaxChartValue('steps')) * 100"
                                 [style.animation-delay.ms]="i * 100"
                                 (mouseenter)="showBarTooltip('steps', i, $event)">
                            </div>
                            <div *ngIf="tooltip.steps.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.steps.left"
                                 [style.top.px]="tooltip.steps.top">
                                <div class="tooltip-value">{{ tooltip.steps.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.steps.label }}</div>
                            </div>
                        </div>

                        <!-- Line chart -->
                        <div *ngSwitchCase="'line'" class="chart-line">
                            <svg class="chart-svg" viewBox="0 0 100 100" preserveAspectRatio="none"
                                 (mousemove)="onSvgMove('steps', $event)" (mouseleave)="onSvgLeave('steps')">
                                <polyline class="line-polyline" [attr.points]="getSvgLinePoints('steps')" />
                            </svg>
                            <div *ngIf="tooltip.steps.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.steps.left"
                                 [style.top.px]="tooltip.steps.top">
                                <div class="tooltip-value">{{ tooltip.steps.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.steps.label }}</div>
                            </div>
                        </div>

                        <!-- Area chart -->
                        <div *ngSwitchCase="'area'" class="chart-area">
                            <svg class="chart-svg" viewBox="0 0 100 100" preserveAspectRatio="none"
                                 (mousemove)="onSvgMove('steps', $event)" (mouseleave)="onSvgLeave('steps')">
                                <polygon class="area-polygon steps-area" [attr.points]="getSvgAreaPoints('steps')" />
                            </svg>
                            <div *ngIf="tooltip.steps.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.steps.left"
                                 [style.top.px]="tooltip.steps.top">
                                <div class="tooltip-value">{{ tooltip.steps.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.steps.label }}</div>
                            </div>
                        </div>

                        <!-- Fallback -->
                        <div *ngSwitchDefault class="chart-bars">
                            <div *ngFor="let pt of getStepsChartData(); let i = index"
                                 class="chart-bar steps-bar"
                                 [style.height.%]="(pt.value / getMaxChartValue('steps')) * 100"
                                 [style.animation-delay.ms]="i * 100">
                            </div>
                        </div>
                    </ng-container>
                    <div class="chart-labels">
                        <span *ngFor="let pt of getLabelPoints('steps'); trackBy: trackByIdx" class="chart-label">
                            {{ pt.label }}
                        </span>
                    </div>
                </div>
            </div>

            <!-- Calories Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                        </svg>
                        {{ getChartTitle('calories') }}
                    </h3>
                    <div class="chart-info">
                        <ng-container [ngSwitch]="selectedView">
                            <span *ngSwitchCase="'weekly'">Total: {{ caloriesStats.total | number:'1.0-0' }} {{' kcal'}}</span>
                            <span *ngSwitchCase="'trends'">Avg: {{ caloriesStats.average | number:'1.0-0' }} {{' kcal'}}/day</span>
                            <span *ngSwitchDefault>Avg: {{ caloriesStats.average | number:'1.0-0' }} {{' kcal'}}/day</span>
                        </ng-container>
                    </div>
                </div>
                <div class="simple-chart">
                    <!-- Chart type toggle for Calories -->
                    <div class="view-toggle chart-type-toggle">
                        <button class="view-btn" [class.active]="caloriesChartType === 'column'" (click)="setCaloriesChartType('column')">Column</button>
                        <button class="view-btn" [class.active]="caloriesChartType === 'line'" (click)="setCaloriesChartType('line')">Line</button>
                        <button class="view-btn" [class.active]="caloriesChartType === 'area'" (click)="setCaloriesChartType('area')">Area</button>
                    </div>

                    <ng-container [ngSwitch]="caloriesChartType">
                        <!-- Column chart -->
                        <div *ngSwitchCase="'column'" class="chart-bars" (mouseleave)="hideBarTooltip('calories')">
                            <div *ngFor="let pt of getCaloriesChartData(); let i = index; trackBy: trackByIdx"
                                 class="chart-bar calories-bar"
                                 [style.height.%]="(pt.value / getMaxChartValue('calories')) * 100"
                                 [style.animation-delay.ms]="i * 100"
                                 (mouseenter)="showBarTooltip('calories', i, $event)">
                            </div>
                            <div *ngIf="tooltip.calories.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.calories.left"
                                 [style.top.px]="tooltip.calories.top">
                                <div class="tooltip-value">{{ tooltip.calories.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.calories.label }}</div>
                            </div>
                        </div>

                        <!-- Line chart -->
                        <div *ngSwitchCase="'line'" class="chart-line">
                            <svg class="chart-svg" viewBox="0 0 100 100" preserveAspectRatio="none"
                                 (mousemove)="onSvgMove('calories', $event)" (mouseleave)="onSvgLeave('calories')">
                                <polyline class="line-polyline calories-line" [attr.points]="getSvgLinePoints('calories')" />
                            </svg>
                            <div *ngIf="tooltip.calories.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.calories.left"
                                 [style.top.px]="tooltip.calories.top">
                                <div class="tooltip-value">{{ tooltip.calories.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.calories.label }}</div>
                            </div>
                        </div>

                        <!-- Area chart -->
                        <div *ngSwitchCase="'area'" class="chart-area">
                            <svg class="chart-svg" viewBox="0 0 100 100" preserveAspectRatio="none"
                                 (mousemove)="onSvgMove('calories', $event)" (mouseleave)="onSvgLeave('calories')">
                                <polygon class="area-polygon calories-area" [attr.points]="getSvgAreaPoints('calories')" />
                            </svg>
                            <div *ngIf="tooltip.calories.visible" class="chart-tooltip"
                                 [style.left.px]="tooltip.calories.left"
                                 [style.top.px]="tooltip.calories.top">
                                <div class="tooltip-value">{{ tooltip.calories.value | number:'1.0-0' }}</div>
                                <div class="tooltip-label">{{ tooltip.calories.label }}</div>
                            </div>
                        </div>

                        <!-- Fallback -->
                        <div *ngSwitchDefault class="chart-bars">
                            <div *ngFor="let pt of getCaloriesChartData(); let i = index"
                                 class="chart-bar calories-bar"
                                 [style.height.%]="(pt.value / getMaxChartValue('calories')) * 100"
                                 [style.animation-delay.ms]="i * 100">
                            </div>
                        </div>
                    </ng-container>
                    <div class="chart-labels">
                        <span *ngFor="let pt of getLabelPoints('calories'); trackBy: trackByIdx" class="chart-label">
                            {{ pt.label }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics -->
        <div class="analytics-grid">
            <!-- Distance Progress -->
            <div class="analytics-card">
                <h3 class="analytics-title">
                    <svg class="icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor">
                        <circle cx="12" cy="10" r="3"></circle>
                        <path
                            d="m12 21.7-.4-.8a13.5 13.5 0 0 1-2.9-8.9c0-7.4 6-13.4 13.4-13.4S35.5 4.6 35.5 12c0 3.4-1.3 6.6-2.9 8.9l-.4.8Z">
                        </path>
                    </svg>
                    Distance Progress
                </h3>
                <div class="radial-progress">
                    <div class="progress-circle">
                        <div class="progress-fill"
                            [style.--progress]="getDistanceProgress() + '%'">
                        </div>
                    </div>
                    <div class="progress-text">
                        <div class="progress-value">{{ distanceStats.current
                            }}km</div>
                        <div class="progress-label">Today's Distance</div>
                    </div>
                </div>
            </div>

            <!-- Weight Tracking -->
            <div class="analytics-card">
                <h3 class="analytics-title">
                    <svg class="icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor">
                        <polyline
                            points="22,12 18,12 15,21 9,3 6,12 2,12"></polyline>
                    </svg>
                    Weight Tracking
                </h3>
                <div class="weight-chart">
                    <div class="weight-line">
                        <div *ngFor="let data of getRecentData(); let i = index"
                            class="weight-point"
                            [style.left.%]="(i / (getRecentData().length - 1)) * 100"
                            [style.bottom.%]="((data.weight - getMinWeight()) / (getMaxWeight() - getMinWeight())) * 100">
                        </div>
                    </div>
                </div>
                <div class="weight-stats">
                    <div class="weight-stat">
                        <span class="stat-label">Current</span>
                        <span class="stat-value">{{ weightStats.current
                            }}{{' kg'}}</span>
                    </div>
                    <div class="weight-stat">
                        <span class="stat-label">Change</span>
                            <span class="stat-value" [class.success]="getWeightLossKg() > 0" [class.error]="getWeightLossKg() < 0">{{ getWeightLossKg() }}{{' kg'}}</span>
                    </div>
                </div>
            </div>

            <!-- Activity Summary -->
            <div class="analytics-card">
                <h3 class="analytics-title">
                    <svg class="icon" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor">
                        <line x1="12" y1="20" x2="12" y2="10"></line>
                        <line x1="18" y1="20" x2="18" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="16"></line>
                    </svg>
                    Activity Summary
                </h3>
                <div class="activity-bars">
                    <div *ngFor="let activity of activityLevels"
                        class="activity-row">
                        <div class="activity-info">
                            <span class="activity-label">{{ activity.label
                                }}</span>
                            <span class="activity-value">{{ activity.value
                                }}%</span>
                        </div>
                        <div class="activity-bar-container">
                            <div class="activity-bar"
                                [style.width.%]="activity.value"
                                [style.background-color]="activity.color">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Stats -->
        <div class="footer-stats">
            <div class="footer-stat">
                <div class="footer-value cyan">{{ globalStats.daysTracked }}</div>
                <div class="footer-label">Days Tracked</div>
            </div>
            <div class="footer-stat">
                <div class="footer-value green">{{ getGoalAchievement()
                    }}%</div>
                <div class="footer-label">Goal Achievement</div>
            </div>
            <div class="footer-stat">
                <div class="footer-value orange">{{ getTotalDistance()
                    }}km</div>
                <div class="footer-label">Total Distance</div>
            </div>
            <div class="footer-stat">
                <div class="footer-value purple">A+</div>
                <div class="footer-label">Health Score</div>
            </div>
        </div>
    </div>
</div>